<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIMT Smart Attendance</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        
        .header {
            text-align: center; color: white; margin-bottom: 30px; 
            font-size: 2.5em; text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .tabs { 
            display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap;
        }
        .tab-btn { 
            flex: 1; min-width: 150px; padding: 15px; background: rgba(255,255,255,0.2); 
            border: none; border-radius: 12px; color: white; font-size: 16px; 
            font-weight: 600; cursor: pointer; backdrop-filter: blur(10px); 
            transition: all 0.3s;
        }
        .tab-btn.active { background: rgba(255,255,255,0.9); color: #333; }
        .tab-btn:hover { transform: translateY(-2px); }
        
        .panel { 
            display: none; background: rgba(255,255,255,0.95); 
            border-radius: 20px; padding: 30px; backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1); 
        }
        .panel.active { display: block; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        input, select, button { 
            width: 100%; padding: 15px; border: 2px solid #e1e5e9; 
            border-radius: 12px; font-size: 16px; transition: all 0.3s;
        }
        input:focus, select:focus { 
            outline: none; border-color: #667eea; 
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1); 
        }
        button { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; border: none; font-weight: 600; cursor: pointer;
            text-transform: uppercase; letter-spacing: 1px;
        }
        button:hover:not(:disabled) { 
            transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102,126,234,0.3); 
        }
        button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        
        .status { 
            padding: 15px; border-radius: 12px; margin: 20px 0; 
            font-weight: 600; text-align: center; 
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        .live-table { 
            width: 100%; border-collapse: collapse; margin-top: 20px; 
        }
        .live-table th, .live-table td { 
            padding: 12px; text-align: left; border-bottom: 1px solid #eee; 
        }
        .live-table th { background: #f8f9fa; font-weight: 600; color: #333; }
        .live-table tr:hover { background: #f8f9fa; }
        
        .status-on { 
            background: #d4edda; color: #155724; padding: 4px 8px; 
            border-radius: 6px; font-size: 12px; font-weight: 600;
        }
        .status-late { 
            background: #fff3cd; color: #856404; padding: 4px 8px; 
            border-radius: 6px; font-size: 12px; font-weight: 600;
        }
        
        .code-display {
            background: white; padding: 30px; border-radius: 16px; 
            text-align: center; margin: 20px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .session-code { 
            font-size: 3em; font-weight: bold; color: #667eea; 
            letter-spacing: 5px; margin: 10px 0;
        }
        .copy-btn { 
            background: #28a745; padding: 10px 20px; font-size: 14px; 
            margin-top: 15px;
        }
        
        .stats-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; margin: 20px 0; 
        }
        .stat-card { 
            background: white; padding: 25px; border-radius: 16px; 
            text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            transition: transform 0.3s;
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-number { font-size: 2.5em; font-weight: bold; color: #667eea; }
        .stat-label { color: #666; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        
        .subject-grid { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
            gap: 20px; 
        }
        .subject-card { 
            background: white; border-radius: 16px; padding: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .subject-header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0;
        }
        .subject-name { font-size: 1.3em; font-weight: 600; color: #333; }
        .count-badge { 
            background: #667eea; color: white; padding: 6px 12px; 
            border-radius: 20px; font-weight: 600; font-size: 14px;
        }
        .footer {
    margin-top: 40px;
    text-align: center;
    color: rgba(255, 255, 255, 0.85);
    font-size: 14px;
    font-weight: 600;
    letter-spacing: 0.5px;
}
        
        @media (max-width: 768px) {
            .tabs { flex-direction: column; }
            .stats-grid, .subject-grid { grid-template-columns: 1fr; }
            .session-code { font-size: 2em; }
            .live-table { font-size: 14px; }
            .live-table thead { display: none; }
            .live-table tr { 
                display: block; margin-bottom: 15px; padding: 15px; 
                background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            .live-table td { 
                display: block; text-align: right; padding: 5px 0; 
                position: relative; 
            }
            .live-table td:before { 
                content: attr(data-label); float: left; font-weight: 600; color: #666; 
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="header">üì± RIMT Smart Attendance</h1>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('teacher')">üë®‚Äçüè´ Teacher Panel</button>
            <button class="tab-btn" onclick="switchTab('student')">üéì Student Panel</button>
            <button class="tab-btn" onclick="switchTab('live')">üìä Live View</button>
        </div>
        
        <!-- TEACHER PANEL -->
        <div id="teacher-panel" class="panel active">
            <div class="form-group">
                <label>üë§ Username</label>
                <input type="text" id="t-username" placeholder="admin / teacher1">
            </div>
            <div class="form-group">
                <label>üîí Password</label>
                <input type="password" id="t-password" placeholder="Enter password">
            </div>
            <button onclick="teacherLogin()" id="login-btn">üöÄ Login</button>
            <div id="login-status"></div>
            
            <div id="teacher-content" style="display: none;">
                <div class="form-group">
                    <label>üìö Subject</label>
                    <input type="text" id="t-subject" placeholder="e.g. Mathematics">
                </div>
                <button onclick="generateCode()" id="generate-btn">üé´ Generate Session Code</button>
                
                <div id="code-display" style="display: none;">
                    <div class="code-display">
                        <h3>üì≤ Session Code</h3>
                        <div class="session-code" id="session-code"></div>
                        <p style="color: #666; font-size: 18px;">Share this 6-digit code with students</p>
                        <button class="copy-btn" onclick="copyCode()">üìã Copy Code</button>
                    </div>
                </div>
                
                <div class="stats-grid" id="teacher-stats" style="display: none;">
                    <div class="stat-card">
                        <div class="stat-number" id="total-present">-</div>
                        <div class="stat-label">Total Present</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="on-time">-</div>
                        <div class="stat-label">On Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="unique-devices">-</div>
                        <div class="stat-label">Unique Devices</div>
                    </div>
                </div>
                
                <div id="teacher-live">
                    <h3>üìà Live Attendance Dashboard</h3>
                    <div id="teacher-live-data" class="subject-grid"></div>
                </div>
            </div>
        </div>
        
        <!-- STUDENT PANEL -->
        <div id="student-panel" class="panel">
            <div class="form-group">
                <label>üë§ Full Name</label>
                <input type="text" id="s-name" placeholder="Enter your full name">
            </div>
            <div class="form-group">
                <label>üé´ Roll Number</label>
                <input type="text" id="s-roll" placeholder="e.g. 21CS001">
            </div>
            <div class="form-group">
                <label>üìö Subject</label>
                <input type="text" id="s-subject" placeholder="e.g. Mathematics">
            </div>
            <div class="form-group">
                <label>üî¢ Session Code</label>
                <input type="text" id="s-code" placeholder="6-digit code from teacher">
            </div>
           <button onclick="markAttendance()" id="attendance-btn">‚úÖ Mark My Attendance</button>
            <div id="attendance-status"></div>
        </div>
        
        <!-- LIVE VIEW PANEL -->
        <div id="live-panel" class="panel">
            <div class="form-group">
                <label>üìö Subject</label>
                <input type="text" id="l-subject" placeholder="e.g. Mathematics">
            </div>
            <div class="form-group">
                <label>üî¢ Session Code</label>
                <input type="text" id="l-code" placeholder="6-digit code">
            </div>
            <button onclick="loadLiveAttendance()">üîÑ Refresh Live Data</button>
            <div id="live-table-container">
                <table class="live-table" id="live-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Roll</th>
                            <th>Time</th>
                            <th>Status</th>
                            <th>Device</th>
                        </tr>
                    </thead>
                    <tbody id="live-tbody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // üî• REPLACE THIS WITH YOUR GOOGLE APPS SCRIPT WEB APP URL
        const API_BASE = 'https://script.google.com/macros/s/AKfycbxFdYj8BI4M-eKAo8qd0EZL3lIZOTAdQMwgfzGlzFwnHVkujqECRz5lGZhovqqi8yso/exec'; // <- PASTE YOUR URL HERE!
        
        // Generate unique device ID
        const deviceId = btoa(navigator.userAgent + screen.width + screen.height + Date.now()).substring(0, 32);
        let currentSessionCode = '';
        
        function switchTab(tab) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tab + '-panel').classList.add('active');
            event.target.classList.add('active');
        }
        
        // TEACHER FUNCTIONS
        async function teacherLogin() {
            const btn = document.getElementById('login-btn');
            const status = document.getElementById('login-status');
            const user = document.getElementById('t-username').value.trim();
            const pass = document.getElementById('t-password').value;
            
            if (!user || !pass) return status.innerHTML = '<div class="status error">‚ùå Enter credentials</div>';
            
            btn.disabled = true;
            btn.textContent = 'Logging in...';
            
            try {
                const response = await fetch(`${API_BASE}?action=login&user=${encodeURIComponent(user)}&pass=${encodeURIComponent(pass)}`);
                const result = await response.text();
                
                if (result === 'LOGIN_SUCCESS') {
                    status.innerHTML = '<div class="status success">‚úÖ Login Successful!</div>';
                    document.getElementById('teacher-content').style.display = 'block';
                    document.getElementById('login-btn').style.display = 'none';
                } else {
                    status.innerHTML = '<div class="status error">‚ùå Invalid credentials</div>';
                }
            } catch (e) {
                status.innerHTML = '<div class="status error">‚ùå Network error. Check API URL!</div>';
            }
            
            btn.disabled = false;
            btn.textContent = 'üöÄ Login';
        }
        
        async function generateCode() {
            const subject = document.getElementById('t-subject').value.trim();
            if (!subject) return alert('Enter subject first!');
            
            const btn = document.getElementById('generate-btn');
            btn.disabled = true;
            btn.textContent = 'Generating...';
            
            try {
                const response = await fetch(`${API_BASE}?action=generate&subject=${encodeURIComponent(subject)}&teacher=RIMT Faculty`);
                const result = await response.text();
                
                if (result.startsWith('CODE:')) {
                    currentSessionCode = result.substring(5);
                    document.getElementById('session-code').textContent = currentSessionCode;
                    document.getElementById('code-display').style.display = 'block';
                    document.getElementById('teacher-stats').style.display = 'grid';
                    loadTeacherLive();
                    loadTeacherStats();
                } else {
                    alert('Error: ' + result);
                }
            } catch (e) {
                alert('Network error. Check your API URL!');
            }
            
            btn.disabled = false;
            btn.textContent = 'üé´ Generate Session Code';
        }
        
        function copyCode() {
            navigator.clipboard.writeText(currentSessionCode).then(() => {
                alert('‚úÖ Code copied to clipboard!');
            });
        }
        
        async function loadTeacherLive() {
            if (!currentSessionCode) return;
            try {
                const response = await fetch(`${API_BASE}?action=teacherLive&code=${currentSessionCode}`);
                const data = await response.json();
                displayTeacherLive(data);
            } catch (e) {
                console.error('Live error:', e);
            }
        }
        
        function displayTeacherLive(sessions) {
            const container = document.getElementById('teacher-live-data');
            if (sessions.error) {
                container.innerHTML = '<p>No data yet</p>';
                return;
            }
            
            container.innerHTML = '';
            Object.entries(sessions).forEach(([subject, students]) => {
                const card = document.createElement('div');
                card.className = 'subject-card';
                card.innerHTML = `
                    <div class="subject-header">
                        <div class="subject-name">${subject}</div>
                        <div class="count-badge">${students.length} students</div>
                    </div>
                    <div style="max-height: 300px; overflow-y: auto;">
                        ${students.map(s => `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0;">
                                <span style="font-weight: 500;">${s.name}</span>
                                <span style="font-size: 13px; color: #666;">
                                    ${s.roll} ‚Ä¢ ${s.status} 
                                    <span style="font-size: 11px;">‚Ä¢ ${s.device.substring(0,8)}...</span>
                                </span>
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        async function loadTeacherStats() {
            if (!currentSessionCode) return;
            try {
                const response = await fetch(`${API_BASE}?action=analytics&code=${currentSessionCode}`);
                const stats = await response.json();
                document.getElementById('total-present').textContent = stats.totalPresent;
                document.getElementById('on-time').textContent = stats.onTime;
                document.getElementById('unique-devices').textContent = stats.uniqueDevices;
            } catch (e) {}
        }
        
        // STUDENT FUNCTIONS
     async function markAttendance() {
    const name = document.getElementById('s-name').value.trim();
    const roll = document.getElementById('s-roll').value.trim();
    const subject = document.getElementById('s-subject').value.trim();
    const code = document.getElementById('s-code').value.trim();
    const status = document.getElementById('attendance-status');
    const btn = document.getElementById('attendance-btn');

    if (!name || !roll || !subject || !code) {
        return status.innerHTML = '<div class="status error">‚ùå Fill all fields</div>';
    }

    // üîÑ START LOADING
    btn.disabled = true;
    btn.textContent = 'Submitting...';
    status.innerHTML = '';

    try {
        const response = await fetch(API_BASE, {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({
                name, roll, subject, code, deviceId
            })
        });

        const result = await response.text();
        status.innerHTML = `<div class="status ${result.startsWith('‚úÖ') ? 'success' : 'error'}">${result}</div>`;

        if (result.startsWith('‚úÖ')) {
            document.getElementById('s-name').value = '';
            document.getElementById('s-roll').value = '';
            document.getElementById('s-subject').value = '';
            document.getElementById('s-code').value = '';
        }

    } catch (e) {
        status.innerHTML = '<div class="status error">‚ùå Network error</div>';
    }

    // ‚úÖ STOP LOADING
    btn.disabled = false;
    btn.textContent = '‚úÖ Mark My Attendance';
}
        
        // AUTO-REFRESH
        setInterval(() => {
            if (currentSessionCode && document.getElementById('teacher-panel').classList.contains('active')) {
                loadTeacherLive();
                loadTeacherStats();
            }
        }, 3000);
        
        // ENTER KEY SUPPORT
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const activePanel = document.querySelector('.panel.active');
                if (activePanel.id === 'student-panel') markAttendance();
                else if (activePanel.id === 'teacher-panel' && document.getElementById('teacher-content').style.display !== 'none') generateCode();
            }
        });
        
        console.log('Device ID:', deviceId);
        console.log('API URL:', API_BASE);
    </script>
<div class="footer">
    POWERED BY CODEVERSE ‚Äì RIMT UNIVERSITY
</div>

</body>
</html
